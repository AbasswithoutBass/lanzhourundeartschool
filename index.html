<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…°å·æ¶¦å¾·è‰ºæœ¯å­¦æ ¡ | å®˜æ–¹é—¨æˆ·</title>
    <style>
        :root {
            --primary-purple: #660874;
            --primary-purple-light: #8b2a9b;
            --apple-dark: #1d1d1f;
            --apple-gray: #f5f5f7;
            --card-bg: linear-gradient(135deg, #fdfbfb 0%, #f8f5fa 100%);
            --glass: rgba(255, 255, 255, 0.92);
            --gold: #d4af37;
            --shadow-soft: 0 8px 24px rgba(102, 8, 116, 0.08);
        }

        body, html { margin: 0; padding: 0; font-family: "SF Pro Display", "PingFang SC", sans-serif; -webkit-font-smoothing: antialiased; scroll-behavior: smooth; background: #fff; }

        /* --- å¯¼èˆªæ  --- */
        nav {
            position: fixed; top: 0; width: 100%; height: 50px;
            background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            z-index: 9999; border-bottom: 1px solid rgba(0,0,0,0.1);
            display: flex; align-items: center; justify-content: center;
        }
        nav a { color: var(--apple-dark); text-decoration: none; font-size: 13px; margin: 0 15px; opacity: 0.7; transition: 0.3s; font-weight: 500; cursor: pointer; }
        nav a:hover { opacity: 1; color: var(--primary-purple); }
        .nav-active { opacity: 1; color: var(--primary-purple); font-weight: 600; }

        .ticker { margin-top: 50px; background: #000; color: #fff; padding: 8px 0; font-size: 12px; text-align: center; }

        /* --- è§†é¢‘ Hero --- */
        .hero {
            height: 90vh; position: relative; overflow: hidden;
            display: flex; align-items: center; justify-content: center; color: #fff; text-align: center;
            background: linear-gradient(135deg, #660874 0%, #8b2a9b 50%, #b865c9 100%);
        }
        .hero video, .hero::before {
            position: absolute; top: 50%; left: 50%;
            min-width: 100%; min-height: 100%; width: auto; height: auto;
            transform: translate(-50%, -50%); z-index: 1; object-fit: cover;
        }
        .hero::before {
            content: '';
            background: url('æ¶¦å¾·1.png') center/cover no-repeat;
            z-index: 0;
        }
        .hero-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.35); z-index: 2; }
        .hero-content { z-index: 3; position: relative; }
        .hero h1 { font-size: 4.5rem; margin: 0; font-weight: 700; letter-spacing: -2px; text-shadow: 0 4px 12px rgba(0,0,0,0.3); }

        /* --- é¡µé¢é€»è¾‘ --- */
        .page { display: none; padding-top: 40px; min-height: 80vh; }
        .page-active { display: block; animation: fadeIn 0.6s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- é€šç”¨å†…å®¹æ ·å¼ --- */
        .section { padding: 80px 20px; }
        .container { max-width: 1100px; margin: 0 auto; }
        .section-title { font-size: 3rem; text-align: center; margin-bottom: 60px; font-weight: 700; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
        .card { 
            background: var(--card-bg);
            padding: 40px; 
            border-radius: 24px; 
            text-align: left;
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(102, 8, 116, 0.08);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(102, 8, 116, 0.12);
        }
        .card h3 { 
            color: var(--primary-purple); 
            margin-top: 0; 
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--primary-purple-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* --- ä¼˜ç§€è€ƒç”Ÿæ¿å—æ ·å¼ --- */
        .student-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .student-card { 
            background: linear-gradient(135deg, #ffffff 0%, #faf8fb 100%);
            border: 1px solid rgba(102, 8, 116, 0.1);
            border-radius: 20px; 
            padding: 25px; 
            text-align: center; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.04);
        }
        .student-card:hover { 
            border-color: var(--primary-purple); 
            box-shadow: 0 12px 32px rgba(102, 8, 116, 0.15);
            transform: translateY(-6px);
        }
        .student-photo{width:84px;height:84px;border-radius:16px;object-fit:cover;display:block;margin:0 auto 12px;box-shadow:0 6px 18px rgba(102, 8, 116, 0.12)}
        .student-name { font-size: 1.2rem; font-weight: 700; color: var(--apple-dark); margin-bottom: 5px; }
        .student-school { font-size: 1rem; color: var(--primary-purple); font-weight: 600; margin-bottom: 5px; }
        .student-major { font-size: 0.9rem; color: #86868b; }

        footer { background: var(--apple-dark); color: rgba(255,255,255,0.5); padding: 60px 20px; text-align: center; font-size: 12px; }
    </style>
</head>
<body>

    <nav id="nav">
        <a onclick="showPage('home')" class="nav-active">é¦–é¡µ</a>
        <a onclick="showPage('about')">å­¦æ ¡è®¾æ–½</a>
        <a onclick="showPage('students')">ä¼˜ç§€è€ƒç”Ÿ</a>
        <a onclick="showPage('teachers')">åå¸ˆåŠ›é‡</a>
        <a onclick="showPage('admission')">ä¿¡æ¯é—¨æˆ·</a>
        <a onclick="showPage('contact')">è”ç³»æˆ‘ä»¬</a>
    </nav>

    <div class="ticker">ğŸ“¢ æœ€æ–°åŠ¨æ€ï¼š2026å±Šå¯’å‡é›†è®­æ­£å¼å¼€å¯é¢„çº¦ï¼æ­å–œæ¶¦å¾·å­¦å­åœ¨å¾€å±Šè€ƒè¯•ä¸­å–å¾—è¾‰ç…Œæˆ˜ç»©ï¼</div>

    <div id="home" class="page page-active">
        <section class="hero">
            <div class="hero-overlay"></div>
            <video id="heroVideo" autoplay muted loop playsinline poster="æ¶¦å¾·1.png">
                <source data-src="rundevideo.mov" type="video/quicktime">
            </video>
            <div class="hero-content">
                <h1>é€å…‰è¸æ¢¦ â€¢ å‰é€”ç”Ÿè¾‰</h1>
                <p style="font-size: 1.5rem; font-weight: 300; margin-top: 15px;">è‚²å¾·ç«‹è‰ºï¼ŒåŠ©åŠ›æ¯ä¸€é¢—è‰ºæœ¯æ˜Ÿè¾°</p>
            </div>
        </section>
        
        <section class="section container">
            <div class="grid">
                <div class="card">
                    <h3>å­¦æ ¡æ¦‚å†µ</h3>
                    <p>å åœ°6000ä½™å¹³ç±³ï¼Œæ‹¥æœ‰70ä½™é—´ç‹¬ç«‹ç´æˆ¿ã€ç»¼åˆéŸ³ä¹å…åŠä¸“ä¸šèˆè¹ˆåŠŸå…ã€‚æˆ‘ä»¬è‡´åŠ›äºæ‰“é€ æœ€ä¸“ä¸šçš„è‰ºè€ƒæˆé•¿ç©ºé—´ã€‚</p>
                </div>
                <div class="card">
                    <h3>è¾‰ç…Œæˆ˜ç»©</h3>
                    <p>å¤šå¹´æ¥ï¼Œæ¶¦å¾·å‘å…¨å›½å„å¤§éŸ³ä¹ã€èˆè¹ˆé™¢æ ¡è¾“é€äº†å¤§é‡ä¼˜è´¨ç”Ÿæºï¼Œè¿‡çº¿ç‡ç¨³å±…å…¨çœå‰èŒ…ã€‚</p>
                    <a onclick="showPage('students')" style="color:var(--primary-purple); font-weight:600; cursor:pointer;">æŸ¥çœ‹åäººå ‚ ></a>
                </div>
            </div>
        </section>
    </div>

    <div id="about" class="page">
        <section class="section container">
            <h2 class="section-title">ä¸€æµè®¾æ–½ï¼Œè´´å¿ƒæœåŠ¡</h2>
            <div class="card" style="margin-bottom:30px;">
                <p>å­¦æ ¡å åœ°6000ä½™å¹³ç±³ã€‚é…å¤‡ç»¼åˆéŸ³ä¹å…ã€3é—´ä¸“ä¸šèˆè¹ˆåŠŸå…ã€70ä½™é—´ç‹¬ç«‹ç´æˆ¿ã€10é—´å¤šåŠŸèƒ½æ•™å®¤ã€‚å®¿èˆé‡‡ç”¨å¹²æ¹¿åˆ†ç¦»è®¾è®¡ï¼Œæä¾›æ´—è¡£æˆ¿ä¸24å°æ—¶çƒ­æ°´ï¼Œå…¨æ–¹ä½ä¿éšœå­¦ä¹ ç”Ÿæ´»ã€‚</p>
            </div>
            <div style="height: 400px; background: url('æ¶¦å¾·1.png') center/cover; border-radius: 40px;"></div>
        </section>
    </div>

    <div id="students" class="page">
        <section class="section container">
            <h2 class="section-title">æ¶¦å¾·åäººå ‚</h2>
            <p style="text-align: center; margin-top: -40px; margin-bottom: 60px; color: #86868b;">è§è¯æ¢¦æƒ³æˆçœŸçš„ç¬é—´ï¼Œä¸‹ä¸€ä¸ªå°±æ˜¯ä½ </p>
            <div id="students-grid" class="student-grid"></div>

            <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

            <script>
            (function(){
                const grid = document.getElementById('students-grid');
                if(!grid) return;

                if (location.protocol === 'file:') {
                    grid.innerHTML = [
                        '<div class="student-card" style="background: var(--apple-gray); border-style: dashed;">',
                        '  <div class="student-name">æœ¬é¡µé¢ä»¥æ–‡ä»¶æ–¹å¼æ‰“å¼€</div>',
                        '  <div class="student-major" style="line-height:1.6">æµè§ˆå™¨ä¼šæ‹¦æˆªè¯»å–æœ¬åœ° JSONï¼ˆCORSï¼‰ã€‚è¯·ç”¨æœ¬åœ° HTTP æ‰“å¼€ï¼š<br><b>python3 -m http.server 8000</b><br>ç„¶åè®¿é—®ï¼š<b>http://localhost:8000/</b></div>',
                        '</div>'
                    ].join('');
                    return;
                }

                function fetchJson(url){
                    return fetch(url).then(r => r.ok ? r.json() : Promise.reject(r));
                }

                fetchJson('data/hall_of_fame_students.json')
                    .then(list => Array.isArray(list) && list.length ? list : fetchJson('data/students.json'))
                    .then(list => renderStudents(Array.isArray(list) ? list : []))
                    .catch(err => {
                        console.error('åŠ è½½åäººå ‚æ•°æ®å¤±è´¥', err);
                        grid.innerHTML = '<div class="student-card" style="background: var(--apple-gray); border-style: dashed;"><div class="student-name">...</div><div class="student-major">æ›´å¤šå½•å–å–œæŠ¥æ›´æ–°ä¸­</div></div>';
                    });

                function esc(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

                function renderStudents(students){
                    grid.innerHTML = '';
                    if(!students.length){
                        grid.innerHTML = '<div class="student-card" style="background: var(--apple-gray); border-style: dashed;"><div class="student-name">...</div><div class="student-major">æ›´å¤šå½•å–å–œæŠ¥æ›´æ–°ä¸­</div></div>';
                        return;
                    }

                    students
                        .slice()
                        .sort((a,b)=> (Number(a.year||0)===Number(b.year||0) ? 0 : Number(b.year||0)-Number(a.year||0)))
                        .forEach(s => {
                            const card = document.createElement('div');
                            card.className = 'student-card';
                            const photo = s.photo ? String(s.photo) : 'æ¶¦å¾·1.png';
                            const school = s.originSchool || s.school || '';
                            const major = s.category || s.major || '';
                            card.innerHTML = `
                                <img class="student-photo" src="${esc(photo || 'æ¶¦å¾·1.png')}" alt="${esc(s.name)}">
                                <div class="student-name">${esc(s.name)}</div>
                                <div class="student-school">${esc(school)}</div>
                                <div class="student-major">${esc(major)}</div>
                            `;
                            card.addEventListener('click', ()=> showStudentModal(s));
                            grid.appendChild(card);
                        });

                    const more = document.createElement('div');
                    more.className = 'student-card';
                    more.style.background = 'var(--apple-gray)';
                    more.style.borderStyle = 'dashed';
                    more.innerHTML = '<div class="student-name">...</div><div class="student-major">æ›´å¤šå½•å–å–œæŠ¥æ›´æ–°ä¸­</div>';
                    grid.appendChild(more);
                }

                function showStudentModal(s){
                    const dlg = document.createElement('div');
                    Object.assign(dlg.style, {position:'fixed',left:0,top:0,right:0,bottom:0,background:'rgba(0,0,0,0.72)',backdropFilter:'blur(5px)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:9999});

                    const box = document.createElement('div');
                    Object.assign(box.style, {width:'min(980px,92%)',maxHeight:'86vh',overflow:'auto',background:'#fff',borderRadius:'16px',boxShadow:'0 20px 60px rgba(0,0,0,0.35)'});

                    const photo = s.photo ? String(s.photo) : 'æ¶¦å¾·1.png';
                    const admissions = Array.isArray(s.admissions) ? s.admissions : [];
                    const school = s.originSchool || s.school || '';
                    const major = s.category || s.major || '';
                    const mainSubject = s.mainSubject || '';
                    const subSubject = s.subSubject || '';
                    const examPlace = [s.examProvince, s.examCity].filter(Boolean).join('');
                    const promo = [s.year ? (s.year + 'å±Š') : '', s.examProvince ? (s.examProvince + 'çœ') : '', 'éŸ³ä¹è”è€ƒ'].filter(Boolean).join('');
                    const mainScore = s.mainScore || '';
                    const subScore = s.subScore || '';
                    const totalScore = s.totalScore || '';
                    const majorRank = s.majorRank || '';
                    const mainRank = s.mainRank || '';
                    let posterTypes = Array.isArray(s.posterTypes) ? s.posterTypes : [];
                    if(!posterTypes.length && s.posterMode){
                        const m = String(s.posterMode);
                        if(m === '1') posterTypes = ['main'];
                        if(m === '2') posterTypes = ['main','sub'];
                        if(m === '3') posterTypes = ['main','sub','total'];
                    }

                    box.innerHTML = `
                        <div style="padding:22px 22px 10px">
                            <div style="display:flex;gap:16px;align-items:center">
                                <img src="${esc(photo || 'æ¶¦å¾·1.png')}" style="width:96px;height:96px;object-fit:cover;border-radius:14px;box-shadow:0 8px 18px rgba(102,8,116,0.18)" alt="${esc(s.name)}">
                                <div style="flex:1">
                                    <h3 style="margin:0 0 6px 0">${esc(s.name)}</h3>
                                    <div style="color:#660874;font-weight:600">${esc(school)}</div>
                                    <div style="color:#666;margin-top:4px">${esc(major)}${s.year ? ' Â· ' + esc(s.year) + 'å±Š' : ''}</div>
                                </div>
                                <button id="stuClose" style="border:none;background:rgba(0,0,0,0.06);padding:10px 14px;border-radius:10px;cursor:pointer">å…³é—­</button>
                            </div>
                        </div>
                        <div style="padding:0 22px 22px">
                            <div style="margin-top:8px;color:#111;font-weight:700">æˆç»©ä¿¡æ¯</div>
                            <div style="margin-top:10px;display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px">
                                <div style="background:#f7f7fb;border-radius:12px;padding:10px 12px">
                                    <div style="font-size:12px;color:#999">ä¸»é¡¹</div>
                                    <div style="font-weight:700">${esc(mainSubject || 'â€”')}</div>
                                    <div style="color:#666;font-size:13px;margin-top:4px">åˆ†æ•°ï¼š${esc(mainScore || 'â€”')}</div>
                                    <div style="color:#666;font-size:13px">æ’åï¼š${esc(mainRank || 'â€”')}</div>
                                </div>
                                <div style="background:#f7f7fb;border-radius:12px;padding:10px 12px">
                                    <div style="font-size:12px;color:#999">å‰¯é¡¹</div>
                                    <div style="font-weight:700">${esc(subSubject || 'â€”')}</div>
                                    <div style="color:#666;font-size:13px;margin-top:4px">åˆ†æ•°ï¼š${esc(subScore || 'â€”')}</div>
                                    <div style="color:#666;font-size:13px">ä¸“ä¸šæ’åï¼š${esc(majorRank || 'â€”')}</div>
                                </div>
                                <div style="background:#f7f7fb;border-radius:12px;padding:10px 12px">
                                    <div style="font-size:12px;color:#999">ç»¼åˆ</div>
                                    <div style="font-weight:700">ä¸“ä¸šæ€»åˆ†</div>
                                    <div style="color:#666;font-size:13px;margin-top:4px">æ€»åˆ†ï¼š${esc(totalScore || 'â€”')}</div>
                                    <div style="color:#666;font-size:13px">ä¸“ä¸šæ’åï¼š${esc(majorRank || 'â€”')}</div>
                                </div>
                            </div>

                            ${posterTypes.length ? `
                            <div style="margin-top:16px;color:#111;font-weight:700">æµ·æŠ¥ä¸‹è½½ï¼ˆç¤¾äº¤ç‰ˆï¼‰</div>
                            <div id="posterBox" style="margin-top:10px"></div>
                            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
                                ${posterTypes.includes('main') ? '<button class="poster-btn" data-type="main" style="border:none;background:#660874;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer">ä¸‹è½½ä¸»é¡¹æµ·æŠ¥</button>' : ''}
                                ${posterTypes.includes('sub') ? '<button class="poster-btn" data-type="sub" style="border:none;background:#660874;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer">ä¸‹è½½å‰¯é¡¹æµ·æŠ¥</button>' : ''}
                                ${posterTypes.includes('ear') ? '<button class="poster-btn" data-type="ear" style="border:none;background:#660874;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer">ä¸‹è½½å¬å†™æµ·æŠ¥</button>' : ''}
                                ${posterTypes.includes('theory') ? '<button class="poster-btn" data-type="theory" style="border:none;background:#660874;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer">ä¸‹è½½ä¹ç†æµ·æŠ¥</button>' : ''}
                                ${posterTypes.includes('sight') ? '<button class="poster-btn" data-type="sight" style="border:none;background:#660874;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer">ä¸‹è½½è§†å”±æµ·æŠ¥</button>' : ''}
                                ${posterTypes.includes('total') ? '<button class="poster-btn" data-type="total" style="border:none;background:#660874;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer">ä¸‹è½½ç»¼åˆæµ·æŠ¥</button>' : ''}
                            </div>
                            ` : ''}
                            <div style="margin-top:14px;color:#111;font-weight:700">å½•å–æˆªå›¾</div>
                            ${admissions.length ? `
                                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:12px">
                                    ${admissions.map(a=>{
                                        const img = a && a.image ? String(a.image) : '';
                                        const note = a && a.note ? String(a.note) : '';
                                        return `
                                            <figure style="margin:0;border:1px solid rgba(0,0,0,0.08);border-radius:12px;overflow:hidden;background:#fff">
                                                <img src="${esc(img || 'æ¶¦å¾·1.png')}" style="width:100%;height:180px;object-fit:cover;display:block" alt="å½•å–æˆªå›¾">
                                                ${note ? `<figcaption style="padding:10px 12px;color:#666;font-size:13px">${esc(note)}</figcaption>` : ''}
                                            </figure>
                                        `;
                                    }).join('')}
                                </div>
                            ` : '<div style="margin-top:10px;color:#86868b">æš‚æ— æˆªå›¾ï¼ˆå¯é€šè¿‡ç®¡ç†å·¥å…·æ‰¹é‡å¯¼å…¥å¹¶åŠ æ°´å°ï¼‰</div>'}
                        </div>
                    `;

                                        dlg.appendChild(box);
                    document.body.appendChild(dlg);
                    dlg.querySelector('#stuClose').addEventListener('click', ()=> document.body.removeChild(dlg));
                    dlg.addEventListener('click', (e)=>{ if(e.target===dlg) document.body.removeChild(dlg); });

                                        if(posterTypes.length){
                                                const posterBox = dlg.querySelector('#posterBox');
                                                const btns = dlg.querySelectorAll('.poster-btn');

                                                function buildPoster(type){
                                                        try {
                                                            const el = document.createElement('div');
                                                            el.style.width = '360px'; // 9:16 aspect ratio relative
                                                            el.style.height = '640px';
                                                            el.style.borderRadius = '18px';
                                                            el.style.overflow = 'hidden';
                                                            el.style.position = 'relative';
                                                            el.style.background = '#1a0b2e'; // Fallback
                                                            el.style.color = '#fff';
                                                            el.style.fontFamily = '"PingFang SC", sans-serif';

                                                            // Logic Diff
                                                            let scoreLabel = 'ä¸»é¡¹åˆ†æ•°', rankLabel = 'ä¸»é¡¹æ’å';
                                                            let scoreValue = s.mainScore || 'â€”', rankValue = s.mainRank || 'â€”';
                                                            let heroScore = s.mainScore || 'â€”', heroUnit = 'åˆ†';
                                                            let slogan = 'ä¸»é¡¹å¼ºåŸº Â· æŠ€å‹ç¾¤é›„';
                                                            let floatText = 'å•ç§‘çŠ¶å…ƒ';

                                                            if(type === 'sub'){
                                                                scoreLabel = 'å‰¯é¡¹åˆ†æ•°'; rankLabel = 'ä¸“ä¸šæ’å';
                                                                scoreValue = s.subScore || 'â€”'; rankValue = s.majorRank || 'â€”';
                                                                heroScore = s.subScore || 'â€”';
                                                                slogan = 'å¤šæ‰å¤šè‰º Â· å…¨é¢å¼€èŠ±'; floatText = 'å…¨èƒ½å‘å±•';
                                                            }else if(type === 'ear'){
                                                                scoreLabel = 'å¬å†™åˆ†æ•°'; rankLabel = 'ä¸“ä¸šæ’å';
                                                                scoreValue = s.earTraining || 'â€”'; rankValue = s.majorRank || 'â€”';
                                                                heroScore = s.earTraining || 'â€”';
                                                                slogan = 'å¬éŸ³è¾¨ä½ Â· æ»¡åˆ†å®åŠ›'; floatText = 'åŸºæœ¬åŠŸ';
                                                            }else if(type === 'theory'){
                                                                scoreLabel = 'ä¹ç†åˆ†æ•°'; rankLabel = 'ä¸“ä¸šæ’å';
                                                                scoreValue = s.theory || 'â€”'; rankValue = s.majorRank || 'â€”';
                                                                heroScore = s.theory || 'â€”';
                                                                slogan = 'ä¹ç†æ»¡åˆ† Â· åŸºç¡€æ‰å®'; floatText = 'ç†è®ºæ»¡åˆ†';
                                                            }else if(type === 'sight'){
                                                                scoreLabel = 'è§†å”±åˆ†æ•°'; rankLabel = 'ä¸“ä¸šæ’å';
                                                                scoreValue = s.sightSinging || 'â€”'; rankValue = s.majorRank || 'â€”';
                                                                heroScore = s.sightSinging || 'â€”';
                                                                slogan = 'è§†å”±ç»ƒè€³ Â· å”¯å¿«ä¸ç ´'; floatText = 'è§†å”±æ»¡åˆ†';
                                                            }else if(type === 'total'){
                                                                scoreLabel = 'ä¸“ä¸šæ€»åˆ†'; rankLabel = 'å…¨çœæ’å';
                                                                scoreValue = s.totalScore || 'â€”'; rankValue = s.majorRank || 'â€”';
                                                                heroScore = s.totalScore || 'â€”';
                                                                slogan = 'åˆ¶éœ¸è€ƒåœº Â· ç»¼åˆç‹è€…'; floatText = 'å…¨çœå‰èŒ…';
                                                            }

                                                            const photoSrc = esc(photo || 'æ¶¦å¾·1.png'); // Ensure photo var is available from outer scope
                                                            const scale = s.posterPhotoScale || 1;
                                                            const pX = (s.posterPhotoX || 0) + 'px';
                                                            const pY = (s.posterPhotoY || 0) + 'px';
                                                            
                                                            // Simplified background for safety
                                                            const bgLayer = '<div style="position:absolute;inset:0;background:radial-gradient(circle at 100% 0%, #4a0e69 0%, #1a0b2e 50%, #000 100%);z-index:0"></div>';
                                                            
                                                            // Top RUNDE Badge
                                                            const topBadge = `
                                                                <div style="position:absolute;top:40px;left:40px;right:24px;z-index:10">
                                                                    <div style="display:inline-flex;align-items:center;padding:6px 14px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-radius:99px;font-size:12px;font-weight:700;letter-spacing:1px;margin-bottom:14px;color:#fff">
                                                                        <span style="color:#FFD700;margin-right:6px">RUNDE</span> ART SCHOOL
                                                                    </div>
                                                                    <div style="font-size:12px;color:rgba(255,255,255,0.6);letter-spacing:1px">${esc(s.year || '2026')} OFFICIAL REPORT â€”</div>
                                                                    <div style="font-size:20px;font-weight:900;margin-top:2px;letter-spacing:2px">æ¶¦å¾·è‰ºè€ƒ Â· å–œæŠ¥</div>
                                                                </div>`;

                                                            // Image Circle
                                                            const heroImg = `
                                                                <div style="position:absolute;top:130px;left:0;right:0;text-align:center;z-index:5">
                                                                    <div style="width:140px;height:140px;margin:0 auto;border-radius:50%;padding:4px;background:linear-gradient(180deg, #FFD700, #B8860B);box-shadow:0 20px 50px rgba(0,0,0,0.5);position:relative">
                                                                        <div style="width:100%;height:100%;border-radius:50%;background:#000;overflow:hidden;border:4px solid #fff;position:relative">
                                                                            <img src="${photoSrc}" style="width:100%;height:100%;object-fit:cover;transform:translate(${pX},${pY}) scale(${scale})">
                                                                        </div>
                                                                    </div>
                                                                    <div style="font-size:36px;font-weight:900;margin-top:20px;letter-spacing:4px;text-shadow:0 4px 12px rgba(0,0,0,0.5)">${esc(s.name)}</div>
                                                                    <div style="margin-top:8px;font-size:13px;color:rgba(255,255,255,0.6);font-weight:400;letter-spacing:2px">${esc(examPlace || 'â€”')}</div>
                                                                    <div style="display:inline-block;margin-top:8px;padding:4px 12px;background:#FFD700;color:#000;font-weight:800;font-size:12px;border-radius:4px;transform:skewX(-10deg)">
                                                                        ${esc(major)} Â· ${esc(mainSubject || '')}${subSubject ? ' / ' + esc(subSubject) : ''}
                                                                    </div>
                                                                </div>`;
                                                            
                                                            // Scores
                                                            const bigStat = `
                                                                <div style="position:absolute;top:380px;left:0;right:0;text-align:center;z-index:10">
                                                                    <div style="font-size:32px;font-weight:900;font-style:italic;line-height:1.1;background:linear-gradient(180deg, #fff 40%, #ccc 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 10px 20px rgba(0,0,0,0.5)">
                                                                        ${slogan}
                                                                    </div>
                                                                    <div style="font-family:Impact,sans-serif;font-size:100px;line-height:0.9;color:#FFD700;margin-top:10px;display:flex;align-items:baseline;justify-content:center;text-shadow:0 4px 0 #333333">
                                                                        ${esc(heroScore)}<span style="font-size:24px;font-family:sans-serif;font-weight:700;color:rgba(255,255,255,0.8);text-shadow:none;margin-left:6px">${heroUnit}</span>
                                                                    </div>
                                                                </div>`;

                                                            // Bottom Deck
                                                            const bottomDeck = `
                                                                <div style="position:absolute;bottom:30px;left:24px;right:24px;display:flex;gap:10px;z-index:10">
                                                                    <div style="flex:1;background:rgba(255,255,255,0.06);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.15);border-radius:12px;padding:14px;text-align:left">
                                                                        <div style="font-size:11px;color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px">${scoreLabel}</div>
                                                                        <div style="font-size:20px;font-weight:700;color:#fff">${esc(scoreValue)}</div>
                                                                    </div>
                                                                    <div style="flex:1;background:rgba(255,255,255,0.06);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.15);border-radius:12px;padding:14px;text-align:left">
                                                                        <div style="font-size:11px;color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px">${rankLabel}</div>
                                                                        <div style="font-size:20px;font-weight:700;color:#fff">${esc(rankValue)}</div>
                                                                    </div>
                                                                </div>`;

                                                            el.innerHTML = bgLayer + topBadge + heroImg + bigStat + bottomDeck;
                                                            return el;
                                                        } catch(e) {
                                                            console.error(e);
                                                            const err = document.createElement('div');
                                                            err.innerText = 'Poster Error: ' + e.message;
                                                            return err;
                                                        }
                                                }
                                                
function showPoster(type){
                                                        posterBox.innerHTML = '';
                                                        posterBox.appendChild(buildPoster(type));
                                                }

                                                async function downloadPoster(type){
                                                        const node = buildPoster(type);
                                                        const holder = document.createElement('div');
                                                        holder.style.position = 'fixed';
                                                        holder.style.left = '-10000px';
                                                        holder.style.top = '0';
                                                        holder.appendChild(node);
                                                        document.body.appendChild(holder);
                                                        const canvas = await html2canvas(node, {scale: 3});
                                                        const link = document.createElement('a');
                                                        link.download = `${s.name || 'poster'}_${type}_social.png`;
                                                        link.href = canvas.toDataURL('image/png');
                                                        link.click();
                                                        document.body.removeChild(holder);
                                                }

                                                showPoster(posterTypes[0] || 'main');
                                                btns.forEach(btn=>{
                                                        btn.addEventListener('click', ()=> downloadPoster(btn.dataset.type));
                                                });
                                        }
                }
            })();
            </script>
        </section>
    </div>

    <div id="admission" class="page">
        <section class="section container">
                        <h2 class="section-title">ä¿¡æ¯é—¨æˆ·</h2>
                        <p style="text-align:center;margin-top:-40px;margin-bottom:40px;color:#86868b">é€šçŸ¥å…¬å‘Š / æ”¿ç­–æ–‡ä»¶ / æ‹›ç”Ÿèµ„è®¯ï¼Œé›†ä¸­å‘å¸ƒä¸ç®¡ç†</p>

                        <style>
                            .portal-toolbar{display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap;margin-bottom:18px}
                            .portal-input{padding:12px 14px;border-radius:14px;border:1px solid rgba(0,0,0,0.12);background:#fff;min-width:min(520px,92vw);outline:none}
                            .portal-select{padding:12px 14px;border-radius:14px;border:1px solid rgba(0,0,0,0.12);background:#fff;outline:none}
                            .portal-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
                            .portal-card{background:#fff;border-radius:18px;box-shadow:0 10px 24px rgba(0,0,0,.06);border:1px solid rgba(0,0,0,.06);overflow:hidden;cursor:pointer;transition:transform .2s ease, box-shadow .2s ease}
                            .portal-card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,.10)}
                            .portal-cover{height:148px;background:#f5f5f7;display:flex;align-items:center;justify-content:center;overflow:hidden}
                            .portal-cover img{width:100%;height:100%;object-fit:cover;display:block}
                            .portal-body{padding:14px 16px}
                            .portal-title{font-weight:800;color:#111;line-height:1.35}
                            .portal-meta{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;color:#6B6B6F;font-size:13px}
                            .portal-badge{font-size:12px;padding:4px 10px;border-radius:999px;background:rgba(102,8,116,0.08);color:#660874;font-weight:700}
                            .portal-pinned{background:rgba(255,149,0,0.14);color:#B05B00}
                            .portal-summary{margin-top:10px;color:#444;font-size:13.5px;line-height:1.6}
                        </style>

                        <div class="portal-toolbar">
                            <input id="portal-q" class="portal-input" placeholder="æœç´¢ï¼šæ ‡é¢˜ / æ‘˜è¦ / æ ‡ç­¾â€¦" />
                            <select id="portal-cat" class="portal-select">
                                <option value="">å…¨éƒ¨åˆ†ç±»</option>
                            </select>
                        </div>

                        <div id="portal-grid" class="portal-grid"></div>

                        <script>
                        (function(){
                            const grid = document.getElementById('portal-grid');
                            const qEl = document.getElementById('portal-q');
                            const catEl = document.getElementById('portal-cat');
                            if(!grid || !qEl || !catEl) return;

                            if (location.protocol === 'file:') {
                                grid.innerHTML = [
                                    '<div class="card" style="border-style:dashed">',
                                    '  <h3 style="margin:0 0 8px 0">æœ¬é¡µé¢ä»¥æ–‡ä»¶æ–¹å¼æ‰“å¼€</h3>',
                                    '  <p style="margin:0;color:#666;line-height:1.7">æµè§ˆå™¨ä¼šæ‹¦æˆªè¯»å–æœ¬åœ° JSONï¼ˆCORSï¼‰ï¼Œä¿¡æ¯é—¨æˆ·æ— æ³•åŠ è½½æ•°æ®ã€‚<br>è¯·ç”¨æœ¬åœ° HTTP æ‰“å¼€ï¼š<b>python3 -m http.server 8000</b>ï¼Œç„¶åè®¿é—®ï¼š<b>http://localhost:8000/</b></p>',
                                    '</div>'
                                ].join('');
                                return;
                            }

                            let all = [];

                            fetch('data/portal_posts.json')
                                .then(r => r.ok ? r.json() : Promise.reject(r))
                                .then(list => {
                                    all = Array.isArray(list) ? list : [];
                                    initCats(all);
                                    render();
                                })
                                .catch(err => {
                                    console.error('åŠ è½½ portal_posts.json å¤±è´¥', err);
                                    grid.innerHTML = '<div class="card" style="border-style:dashed"><h3 style="margin:0 0 8px 0">ä¿¡æ¯é—¨æˆ·åŠ è½½å¤±è´¥</h3><p style="margin:0;color:#666">è¯·æ£€æŸ¥ data/portal_posts.json æ˜¯å¦å­˜åœ¨ä¸”ä¸ºæœ‰æ•ˆ JSONã€‚</p></div>';
                                });

                            function esc(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
                            function norm(s){ return String(s||'').trim(); }
                            function parseDate(s){ const d = s ? new Date(String(s)) : null; return d && !isNaN(d.getTime()) ? d : null; }
                            function fmtDate(s){ const d = parseDate(s); if(!d) return ''; const yyyy=d.getFullYear(); const mm=String(d.getMonth()+1).padStart(2,'0'); const dd=String(d.getDate()).padStart(2,'0'); return `${yyyy}-${mm}-${dd}`; }

                            function isPublished(p){
                                const st = String(p && p.status || 'draft').toLowerCase();
                                if(st !== 'published') return false;
                                const when = parseDate(p.publishedAt);
                                if(!when) return true;
                                return when.getTime() <= Date.now();
                            }

                            function initCats(list){
                                const cats = Array.from(new Set((list||[]).map(p => norm(p.category)).filter(Boolean))).sort((a,b)=>a.localeCompare(b,'zh'));
                                cats.forEach(c => {
                                    const opt = document.createElement('option');
                                    opt.value = c;
                                    opt.textContent = c;
                                    catEl.appendChild(opt);
                                });
                            }

                            function filtered(){
                                const q = norm(qEl.value).toLowerCase();
                                const cat = norm(catEl.value);
                                return (all||[])
                                    .filter(isPublished)
                                    .filter(p => !cat || norm(p.category) === cat)
                                    .filter(p => {
                                        if(!q) return true;
                                        const hay = [p.title, p.summary, (p.tags||[]).join(' '), p.category].map(x=>String(x||'')).join(' ').toLowerCase();
                                        return hay.includes(q);
                                    })
                                    .slice()
                                    .sort((a,b)=>{
                                        const ap = !!a.pinned, bp = !!b.pinned;
                                        if(ap !== bp) return ap ? -1 : 1;
                                        const ad = parseDate(a.publishedAt) || parseDate(a.updatedAt);
                                        const bd = parseDate(b.publishedAt) || parseDate(b.updatedAt);
                                        const at = ad ? ad.getTime() : 0;
                                        const bt = bd ? bd.getTime() : 0;
                                        return bt - at;
                                    });
                            }

                            function render(){
                                const list = filtered();
                                grid.innerHTML = '';
                                if(!list.length){
                                    grid.innerHTML = '<div class="card" style="border-style:dashed"><h3 style="margin:0 0 8px 0">æš‚æ— å†…å®¹</h3><p style="margin:0;color:#666">å¯ä»¥åœ¨åå°æ·»åŠ æ–‡ç« ï¼Œç„¶åè¿™é‡Œä¼šè‡ªåŠ¨æ˜¾ç¤ºã€‚</p></div>';
                                    return;
                                }
                                list.forEach(p => {
                                    const card = document.createElement('div');
                                    card.className = 'portal-card';
                                    const cover = norm(p.coverImage);
                                    const badge = norm(p.category) || 'æ–‡ç« ';
                                    const tags = Array.isArray(p.tags) ? p.tags : [];
                                    const dateStr = fmtDate(p.publishedAt || p.updatedAt);
                                    card.innerHTML = `
                                        <div class="portal-cover">${cover ? `<img src="${esc(cover)}" alt="å°é¢">` : '<div style="color:#8e8e93;font-weight:700">æ¶¦å¾· Â· èµ„è®¯</div>'}</div>
                                        <div class="portal-body">
                                            <div class="portal-title">${esc(p.title || 'æœªå‘½å')}</div>
                                            <div class="portal-meta">
                                                <span class="portal-badge">${esc(badge)}</span>
                                                ${p.pinned ? '<span class="portal-badge portal-pinned">ç½®é¡¶</span>' : ''}
                                                ${dateStr ? `<span>${esc(dateStr)}</span>` : ''}
                                                ${tags.slice(0,3).map(t => `<span style="color:#660874">#${esc(t)}</span>`).join('')}
                                            </div>
                                            ${p.summary ? `<div class="portal-summary">${esc(p.summary)}</div>` : ''}
                                        </div>
                                    `;
                                    card.addEventListener('click', ()=> openPost(p));
                                    grid.appendChild(card);
                                });
                            }

                            function openPost(p){
                                const dlg = document.createElement('div');
                                Object.assign(dlg.style, {position:'fixed',left:0,top:0,right:0,bottom:0,background:'rgba(0,0,0,0.72)',backdropFilter:'blur(5px)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:9999});

                                const box = document.createElement('div');
                                Object.assign(box.style, {width:'min(980px,92%)',maxHeight:'86vh',overflow:'auto',background:'#fff',borderRadius:'16px',boxShadow:'0 20px 60px rgba(0,0,0,0.35)'});

                                const cover = norm(p.coverImage);
                                const dateStr = fmtDate(p.publishedAt || p.updatedAt);
                                const cat = norm(p.category);
                                const tags = Array.isArray(p.tags) ? p.tags : [];
                                const bodyHtml = String(p.bodyHtml || '').trim();

                                box.innerHTML = `
                                    ${cover ? `<img src="${esc(cover)}" style="width:100%;height:260px;object-fit:cover;display:block" alt="å°é¢">` : ''}
                                    <div style="padding:18px 20px 0">
                                        <div style="display:flex;gap:12px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap">
                                            <div>
                                                <h2 style="margin:0 0 8px 0;line-height:1.25">${esc(p.title || 'æœªå‘½å')}</h2>
                                                <div style="color:#6B6B6F;font-size:13px;line-height:1.6">
                                                    ${cat ? `<span style="color:#660874;font-weight:700">${esc(cat)}</span>` : ''}
                                                    ${dateStr ? ` <span>Â· ${esc(dateStr)}</span>` : ''}
                                                    ${tags.length ? ` <span>Â· ${tags.slice(0,6).map(t=>`#${esc(t)}`).join(' ')}</span>` : ''}
                                                </div>
                                            </div>
                                            <button id="portalClose" style="border:none;background:rgba(0,0,0,0.06);padding:10px 14px;border-radius:10px;cursor:pointer">å…³é—­</button>
                                        </div>
                                    </div>
                                    <div style="padding:14px 20px 20px;line-height:1.85;color:#111">
                                        ${bodyHtml ? bodyHtml : '<p style="color:#86868b">ï¼ˆæ­£æ–‡ä¸ºç©ºï¼‰</p>'}
                                    </div>
                                `;

                                dlg.appendChild(box);
                                document.body.appendChild(dlg);
                                dlg.querySelector('#portalClose').addEventListener('click', ()=> document.body.removeChild(dlg));
                                dlg.addEventListener('click', (e)=>{ if(e.target===dlg) document.body.removeChild(dlg); });
                            }

                            qEl.addEventListener('input', render);
                            catEl.addEventListener('change', render);
                        })();
                        </script>
        </section>
    </div>

                <div id="teachers" class="page">
                    <!-- åå¸ˆå›¢é˜Ÿï¼ˆæŒ‰éƒ¨é—¨åˆ†ç»„æ¸²æŸ“ï¼‰ -->
                    <!-- ä½¿ç”¨æ›´æ–°åçš„æ¸²æŸ“ç‰‡æ®µï¼šsnippets/teachers_fragment.html -->
                    <!-- æˆ‘ä»¬ç›´æ¥å†…è”ç›¸åŒé€»è¾‘ä»¥é¿å…é¢å¤–è¯·æ±‚ï¼š -->
                    <section id="teachers-section" class="section container" aria-labelledby="teachers-title">
                        <h2 id="teachers-title">åå¸ˆå›¢é˜Ÿ</h2>
                        <div id="teachers-by-dept"></div>
                    </section>

                    <!-- ä¸‹é¢æ ·å¼ä¸è„šæœ¬ä¸ snippets/teachers_fragment.html ä¿æŒä¸€è‡´ -->
                    <style>
                    .dept-block{margin-bottom:32px}
                    .dept-title{
                        font-size:22px;
                        margin:10px 0 16px;
                        color:#2B2B2B;
                        padding-left:12px;
                        border-left:4px solid var(--primary-purple);
                        background: linear-gradient(135deg, var(--primary-purple) 0%, var(--primary-purple-light) 100%);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    }
                    .dept-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px}
                    .teacher-card{
                        background:linear-gradient(135deg, #ffffff 0%, #faf8fb 100%);
                        border-radius:16px;
                        padding:16px;
                        display:flex;
                        gap:12px;
                        align-items:flex-start;
                        box-shadow:0 4px 16px rgba(102, 8, 116, 0.08);
                        border: 1px solid rgba(102, 8, 116, 0.08);
                        cursor:pointer;
                        transform:translateY(12px);
                        opacity:0;
                        transition:all 420ms cubic-bezier(.2,.8,.2,1);
                    }
                    .teacher-card.in{transform:none;opacity:1}
                    .teacher-card:hover{
                        transform:translateY(-8px);
                        box-shadow:0 16px 32px rgba(102, 8, 116, 0.15);
                        border-color: var(--primary-purple);
                    }
                    .teacher-photo{width:72px;height:72px;border-radius:8px;object-fit:cover;flex:0 0 72px}
                    .teacher-meta{flex:1}
                    .teacher-name{font-weight:700;color:#111}
                    .teacher-pos{font-size:13px;color:#6B6B6F;margin-top:4px}
                    /* åªå¯¹â€œå…¥åœºâ€é˜¶æ®µåš staggerï¼Œé¿å…å½±å“åç»­ hover/ç‚¹æŒ‰çš„è·Ÿæ‰‹æ€§ */
                    .teacher-card.fade-enter-stagger:not(.in){transition-delay: var(--stagger)}
                    @media (max-width:520px){.teacher-card{flex-direction:row;gap:10px}.teacher-photo{width:64px;height:64px}}
                    </style>

                    <script>
                    (function(){
                        const container = document.getElementById('teachers-by-dept');
                        if(!container) return;

                        if (location.protocol === 'file:') {
                            container.innerHTML = [
                                '<div style="padding:12px 14px;border:1px dashed rgba(102, 8, 116, 0.28);border-radius:12px;background:rgba(102, 8, 116, 0.04);color:#333;line-height:1.7">',
                                '  <b>æ•™å¸ˆä¿¡æ¯æœªåŠ è½½ï¼š</b>å½“å‰ä»¥æ–‡ä»¶æ–¹å¼æ‰“å¼€ï¼ˆfile://ï¼‰ï¼Œæµè§ˆå™¨ä¼šæ‹¦æˆªè¯»å–æœ¬åœ° JSONï¼ˆCORSï¼‰ã€‚<br>',
                                '  è¯·ç”¨æœ¬åœ° HTTP æ‰“å¼€ï¼š<b>python3 -m http.server 8000</b>ï¼Œç„¶åè®¿é—®ï¼š<b>http://localhost:8000/</b>',
                                '</div>'
                            ].join('');
                            return;
                        }

                        fetch('data/teachers.json')
                            .then(r => r.ok ? r.json() : Promise.reject(r))
                            .then(data => renderByDept(data))
                            .catch(err => {
                                console.error('åŠ è½½ teachers.json å¤±è´¥', err);
                                container.innerHTML = '<p>æ•™å¸ˆä¿¡æ¯åŠ è½½å¤±è´¥ã€‚</p>';
                            });

                        function esc(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

                        // v2 æ•°æ®ï¼šä¸€ä¸ªæ•™å¸ˆå¯¹è±¡å«å¤šä¸ª rolesï¼ˆè·¨éƒ¨é—¨/èº«å…¼æ•°èŒï¼‰
                        // å±•ç¤ºæ’åºï¼šæŒ‰ teacher-liest çš„å‡ºç°é¡ºåºï¼ˆroles[].orderï¼‰
                        function flattenRoleCards(teachers){
                            const cards = [];
                            (teachers || []).forEach(t => {
                                const roles = t.roles || [];
                                roles.forEach(r => {
                                    const order = Number.isFinite(r.order) ? r.order : parseInt(r.order || '999999', 10);
                                    cards.push({
                                        teacher: t,
                                        department: r.department || 'å…¶ä»–',
                                        position: r.position || '',
                                        order: Number.isFinite(order) ? order : 999999
                                    });
                                });
                            });
                            return cards;
                        }

                        function groupByDept(cards){
                            const map = new Map();
                            (cards || []).forEach(c => {
                                const d = c.department || 'å…¶ä»–';
                                if(!map.has(d)) map.set(d, []);
                                map.get(d).push(c);
                            });
                            return map;
                        }

                        function renderByDept(teachers){
                            container.innerHTML = '';
                            const cards = flattenRoleCards(teachers);
                            const groups = groupByDept(cards);

                            // éƒ¨é—¨æ’åºï¼šæŒ‰è¯¥éƒ¨é—¨æœ€æ—©å‡ºç°çš„ role.order
                            const deptEntries = Array.from(groups.entries()).map(([dept, items]) => {
                                const minOrder = Math.min(...items.map(x => x.order));
                                return {dept, items, minOrder};
                            }).sort((a,b)=>{
                                const ad = String(a.dept||'');
                                const bd = String(b.dept||'');
                                if(ad === 'èˆè¹ˆéƒ¨' && bd !== 'èˆè¹ˆéƒ¨') return 1;
                                if(bd === 'èˆè¹ˆéƒ¨' && ad !== 'èˆè¹ˆéƒ¨') return -1;
                                return a.minOrder - b.minOrder;
                            });

                            deptEntries.forEach(({items, dept}) => {
                                const block = document.createElement('section');
                                block.className = 'dept-block';
                                block.innerHTML = `<h3 class="dept-title">${esc(dept)}</h3><div class="dept-grid"></div>`;
                                const grid = block.querySelector('.dept-grid');
                                items
                                  .slice()
                                  .sort((a,b)=>a.order-b.order)
                                  .forEach((c, idx) => {
                                    const t = c.teacher;
                                                                        const photo = t.photo && !String(t.photo).includes('å ä½') ? t.photo : 'æ¶¦å¾·1.png';
                                    const card = document.createElement('article');
                                    card.className = 'teacher-card';
                                    card.setAttribute('role','listitem');
                                    card.innerHTML = `
                                        <img class="teacher-photo" src="${esc(photo)}" alt="${esc(t.name)} å¤´åƒ">
                                        <div class="teacher-meta">
                                            <div class="teacher-name">${esc(t.name)}</div>
                                            <div class="teacher-pos">${esc(c.position)}</div>
                                        </div>
                                    `;
                                    card.addEventListener('click', ()=> showDetail(t, c));
                                    card.style.setProperty('--stagger', (idx * 40) + 'ms');
                                    card.classList.add('fade-enter-stagger');
                                    grid.appendChild(card);
                                });
                                container.appendChild(block);
                            });

                            const obs = new IntersectionObserver((entries)=>{
                                entries.forEach(en => {
                                    if(en.isIntersecting){
                                        const el = en.target;
                                        // è®© CSS çš„ transition-delay è´Ÿè´£ staggerï¼›å…¥åœºåä¸å†å»¶è¿Ÿ
                                        requestAnimationFrame(()=> el.classList.add('in'));
                                        obs.unobserve(el);
                                    }
                                });
                            }, {threshold: 0.12});

                            document.querySelectorAll('.teacher-card').forEach(c => obs.observe(c));
                        }

                        function showDetail(t, roleCtx){
                            const dlg = document.createElement('div');
                            dlg.className = 'teacher-detail-modal';
                            Object.assign(dlg.style, {
                                position:'fixed',
                                left:0,
                                top:0,
                                right:0,
                                bottom:0,
                                background:'rgba(0,0,0,0.75)',
                                backdropFilter:'blur(5px)',
                                display:'flex',
                                alignItems:'center',
                                justifyContent:'center',
                                zIndex:9999,
                                animation:'fadeIn 0.3s ease'
                            });
                            
                            const box = document.createElement('div');
                            Object.assign(box.style, {
                                width:'min(920px,92%)',
                                maxHeight:'85vh',
                                overflow:'auto',
                                background:'linear-gradient(135deg, #ffffff 0%, #f8f4f9 100%)',
                                borderRadius:'16px',
                                boxShadow:'0 20px 60px rgba(102,8,116,0.3)',
                                animation:'slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)',
                                border:'1px solid rgba(139,42,155,0.1)'
                            });
                            
                            box.innerHTML = `
                                <style>
                                    @keyframes fadeIn {
                                        from { opacity: 0; }
                                        to { opacity: 1; }
                                    }
                                    @keyframes slideUp {
                                        from { transform: translateY(30px); opacity: 0; }
                                        to { transform: translateY(0); opacity: 1; }
                                    }
                                    .teacher-detail-modal::-webkit-scrollbar {
                                        width: 8px;
                                    }
                                    .teacher-detail-modal::-webkit-scrollbar-track {
                                        background: rgba(0,0,0,0.1);
                                        border-radius: 4px;
                                    }
                                    .teacher-detail-modal::-webkit-scrollbar-thumb {
                                        background: rgba(102,8,116,0.5);
                                        border-radius: 4px;
                                    }
                                </style>
                                <div style="padding:32px">
                                    <div style="display:flex;gap:24px;align-items:flex-start;margin-bottom:24px">
                                        <img src="${esc(t.photo && !t.photo.includes('å ä½')?t.photo:'æ¶¦å¾·1.png')}" 
                                             style="width:140px;height:140px;object-fit:cover;border-radius:12px;
                                                    box-shadow:0 8px 16px rgba(102,8,116,0.2);
                                                    border:3px solid rgba(139,42,155,0.1)">
                                        <div style="flex:1">
                                            <h2 style="margin:0 0 8px 0;
                                                       background:linear-gradient(135deg, #660874 0%, #8b2a9b 100%);
                                                       -webkit-background-clip:text;
                                                       -webkit-text-fill-color:transparent;
                                                       background-clip:text;
                                                       font-size:32px;
                                                       font-weight:700">
                                                ${esc(t.name)}
                                            </h2>
                                            <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:12px">
                                                <span style="padding:6px 14px;
                                                             background:linear-gradient(135deg, #660874 0%, #8b2a9b 100%);
                                                             color:white;
                                                             border-radius:20px;
                                                             font-size:14px;
                                                             font-weight:500;
                                                             box-shadow:0 2px 8px rgba(102,8,116,0.3)">
                                                    ${esc(roleCtx && roleCtx.position ? roleCtx.position : '')}
                                                </span>
                                                <span style="padding:6px 14px;
                                                             background:rgba(139,42,155,0.1);
                                                             color:#660874;
                                                             border-radius:20px;
                                                             font-size:14px;
                                                             font-weight:500">
                                                    ${esc(roleCtx && roleCtx.department ? roleCtx.department : (t.department || ''))}
                                                </span>
                                            </div>
                                            <div style="color:#666;font-size:15px;line-height:1.6;
                                                       padding:12px;
                                                       background:rgba(139,42,155,0.05);
                                                       border-left:3px solid #8b2a9b;
                                                       border-radius:4px">
                                                ${esc(t.shortSummary || 'èµ„æ·±æ•™å¸ˆï¼Œç»éªŒä¸°å¯Œ')}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style="margin-top:28px;padding:20px;
                                               background:white;
                                               border-radius:12px;
                                               box-shadow:0 2px 8px rgba(0,0,0,0.05)">
                                        <h3 style="margin:0 0 16px 0;
                                                   color:#660874;
                                                   font-size:20px;
                                                   padding-bottom:12px;
                                                   border-bottom:2px solid rgba(139,42,155,0.2)">
                                            ä¸ªäººç®€ä»‹
                                        </h3>
                                        <p style="line-height:1.8;
                                                  color:#333;
                                                  font-size:15px;
                                                  margin:0;
                                                  text-align:justify">
                                            ${esc(t.bio)}
                                        </p>
                                    </div>
                                    
                                    ${(t.achievements && t.achievements.length > 0) ? `
                                    <div style="margin-top:24px;padding:20px;
                                               background:white;
                                               border-radius:12px;
                                               box-shadow:0 2px 8px rgba(0,0,0,0.05)">
                                        <h3 style="margin:0 0 16px 0;
                                                   color:#660874;
                                                   font-size:20px;
                                                   padding-bottom:12px;
                                                   border-bottom:2px solid rgba(139,42,155,0.2)">
                                            ä¸»è¦æˆå°±
                                        </h3>
                                        <ul style="margin:0;
                                                   padding-left:24px;
                                                   color:#333;
                                                   line-height:1.8;
                                                   font-size:15px">
                                            ${t.achievements.map(a=>`<li style="margin-bottom:8px">${esc(a)}</li>`).join('')}
                                        </ul>
                                    </div>
                                    ` : ''}
                                    
                                    <div style="text-align:center;margin-top:28px">
                                        <button id="closeBtn" 
                                                style="padding:12px 48px;
                                                       background:linear-gradient(135deg, #660874 0%, #8b2a9b 100%);
                                                       color:white;
                                                       border:none;
                                                       border-radius:25px;
                                                       font-size:16px;
                                                       font-weight:600;
                                                       cursor:pointer;
                                                       box-shadow:0 4px 12px rgba(102,8,116,0.3);
                                                       transition:all 0.3s ease">
                                            å…³é—­
                                        </button>
                                    </div>
                                </div>
                            `;
                            
                            dlg.appendChild(box);
                            document.body.appendChild(dlg);
                            
                            // æ·»åŠ å…³é—­æŒ‰é’®äº¤äº’æ•ˆæœ
                            const closeBtn = dlg.querySelector('#closeBtn');
                            closeBtn.addEventListener('mouseenter', function() {
                                this.style.transform = 'scale(1.05)';
                                this.style.boxShadow = '0 6px 20px rgba(102,8,116,0.4)';
                            });
                            closeBtn.addEventListener('mouseleave', function() {
                                this.style.transform = 'scale(1)';
                                this.style.boxShadow = '0 4px 12px rgba(102,8,116,0.3)';
                            });
                            
                            // ç‚¹å‡»èƒŒæ™¯å…³é—­
                            dlg.addEventListener('click', (e) => {
                                if(e.target === dlg) {
                                    dlg.style.animation = 'fadeOut 0.3s ease';
                                    setTimeout(() => document.body.removeChild(dlg), 300);
                                }
                            });
                            
                            // ç‚¹å‡»å…³é—­æŒ‰é’®
                            closeBtn.addEventListener('click', () => {
                                dlg.style.animation = 'fadeOut 0.3s ease';
                                setTimeout(() => document.body.removeChild(dlg), 300);
                            });
                            
                            // æ·»åŠ æ·¡å‡ºåŠ¨ç”»
                            const style = document.createElement('style');
                            style.textContent = '@keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }';
                            document.head.appendChild(style);
                        }

                    })();
                    </script>
                </div>
    <div id="contact" class="page"><section class="section container"><h2>è”ç³»æˆ‘ä»¬ï¼šXXX-XXXX-XXXX</h2></section></div>

    <footer>
        <p>Â© 2026 å…°å·æ¶¦å¾·è‰ºæœ¯å­¦æ ¡ | è‚²å¾·ç«‹è‰º åŠ©åŠ›æ¢¦æƒ³</p>
    </footer>

    <script>
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('page-active'));
            document.getElementById(pageId).classList.add('page-active');
            document.querySelectorAll('nav a').forEach(l => l.classList.remove('nav-active'));
            if(event) event.target.classList.add('nav-active');
            window.scrollTo(0, 0);
        }

        (function initHeroVideo() {
            const video = document.getElementById('heroVideo');
            if (!video) return;

            const source = video.querySelector('source[data-src]');
            const src = source && source.getAttribute('data-src');
            if (!source || !src) return;

            // file:// ä¸‹ fetch/åª’ä½“åŠ è½½ç­–ç•¥å„æµè§ˆå™¨å·®å¼‚å¤§ï¼Œç›´æ¥ç”¨å°é¢å›¾å…œåº•å³å¯ã€‚
            if (location.protocol === 'file:') return;

            fetch(src, { method: 'HEAD' })
                .then(r => {
                    if (!r.ok) return;
                    source.src = src;
                    video.load();
                    const p = video.play();
                    if (p && typeof p.catch === 'function') p.catch(() => {});
                })
                .catch(() => {});
        })();
    </script>
</body>
</html>